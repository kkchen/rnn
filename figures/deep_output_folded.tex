\begin{tikzpicture}[node distance=5mm, auto]
    \node (state 1) [state] {$\s_{1t}$};
    \node (state 2) [state, above=of state 1] {$\s_{2t}$};
    \node (input) [state, below=of state 1] {$\x_t$};
    \node (output) [state, above=of state 2] {$\y_t$};
    \node (loss) [function, above=of output] {$L$};
    \node (data) [data, above=of loss] {$\ETA_t$};

    \foreach \i in {1, 2} {%
        \node (skip \i) [inner sep=0.5mm, above=1mm of state \i] {};
        \node (skip \i l) [coordinate, left=7mm of skip \i] {};
        \node (skip \i r) [coordinate, right=7mm of skip \i] {};
    }

    % Arrows.
    \draw [path] (input) -- node [label, pos=0.4, right] {$\f$} (state 1);
    \draw [path] (state 1) -- node [label, pos=0.7, right] {$\g$} (state 2);
    \draw [path] (state 2) -- node [label, pos=0.4, right] {$\h$} (output);
    \draw [path] (output) -- (loss);
    \draw [path] (data) -- (loss);

    \foreach \i/\j in {1/\f} {%
        \draw [thick] (state \i) -| node [label, right, pos=0.7] {$\j$} (skip \i r) -- (skip \i);
        \draw [path] (skip \i) -- (skip \i l) |- (state \i);
    }
\end{tikzpicture}
%%% Local Variables:
%%% mode: latex
%%% TeX-master: "../rnn"
%%% End:
